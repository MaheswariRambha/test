[('assured_workload.tf', '/**\n * Copyright 2023 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nresource "google_assured_workloads_workload" "workload" {\n  count = var.assured_workload_configuration.enabled ? 1 : 0\n\n  organization                 = local.org_id\n  billing_account              = "billingAccounts/${local.billing_account}"\n  provisioned_resources_parent = google_folder.env.id\n  compliance_regime            = var.assured_workload_configuration.compliance_regime\n  display_name                 = var.assured_workload_configuration.display_name\n  location                     = var.assured_workload_configuration.location\n\n  resource_settings {\n    resource_type = var.assured_workload_configuration.resource_type\n  }\n}\n\n'), ('folders.tf', '/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/******************************************\n  Environment Folder\n*****************************************/\n\nresource "google_folder" "env" {\n  display_name = "${local.folder_prefix}-${var.env}"\n  parent       = local.parent\n}\n\nresource "time_sleep" "wait_60_seconds" {\n  depends_on = [google_folder.env]\n\n  destroy_duration = "60s"\n}\n\n# The following code binds a tag to a resource.\n# For more details about binding tags to resources see: https://cloud.google.com/resource-manager/docs/tags/tags-creating-and-managing#attaching\n# For more details on how to use terraform binding resource see: https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/tags_tag_binding\nresource "google_tags_tag_binding" "folder_env" {\n  parent    = "//cloudresourcemanager.googleapis.com/${google_folder.env.id}"\n  tag_value = local.tags["environment_${var.env}"]\n\n  depends_on = [time_sleep.wait_60_seconds]\n}\n\n'), ('iam.tf', '/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/******************************************\n  Monitoring - IAM\n*****************************************/\n\nresource "google_project_iam_member" "monitoring_editor" {\n  project = module.monitoring_project.project_id\n  role    = "roles/monitoring.editor"\n  member  = "group:${var.monitoring_workspace_users}"\n}\n\n'), ('main.tf', '/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nlocals {\n  org_id          = data.terraform_remote_state.bootstrap.outputs.common_config.org_id\n  parent          = data.terraform_remote_state.bootstrap.outputs.common_config.parent_id\n  billing_account = data.terraform_remote_state.bootstrap.outputs.common_config.billing_account\n  project_prefix  = data.terraform_remote_state.bootstrap.outputs.common_config.project_prefix\n  folder_prefix   = data.terraform_remote_state.bootstrap.outputs.common_config.folder_prefix\n  tags            = data.terraform_remote_state.org.outputs.tags\n}\n\ndata "terraform_remote_state" "bootstrap" {\n  backend = "gcs"\n\n  config = {\n    bucket = var.remote_state_bucket\n    prefix = "terraform/bootstrap/state"\n  }\n}\n\ndata "terraform_remote_state" "org" {\n  backend = "gcs"\n\n  config = {\n    bucket = var.remote_state_bucket\n    prefix = "terraform/org/state"\n  }\n}\n\n'), ('monitoring.tf', '/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/******************************************\n  Projects for monitoring workspaces\n*****************************************/\n\nmodule "monitoring_project" {\n  source  = "terraform-google-modules/project-factory/google"\n  version = "~> 14.0"\n\n  random_project_id           = true\n  random_project_id_length    = 4\n  name                        = "${local.project_prefix}-${var.environment_code}-monitoring"\n  org_id                      = local.org_id\n  billing_account             = local.billing_account\n  folder_id                   = google_folder.env.id\n  disable_services_on_destroy = false\n  depends_on                  = [time_sleep.wait_60_seconds]\n  activate_apis = [\n    "logging.googleapis.com",\n    "monitoring.googleapis.com",\n    "billingbudgets.googleapis.com"\n  ]\n\n  labels = {\n    environment       = var.env\n    application_name  = "env-monitoring"\n    billing_code      = "1234"\n    primary_contact   = "example1"\n    secondary_contact = "example2"\n    business_code     = "abcd"\n    env_code          = var.environment_code\n  }\n  budget_alert_pubsub_topic   = var.project_budget.monitoring_alert_pubsub_topic\n  budget_alert_spent_percents = var.project_budget.monitoring_alert_spent_percents\n  budget_amount               = var.project_budget.monitoring_budget_amount\n}\n\n'), ('networking.tf', '/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/******************************************\n  Projects for Shared VPCs\n*****************************************/\n\nmodule "base_shared_vpc_host_project" {\n  source  = "terraform-google-modules/project-factory/google"\n  version = "~> 14.0"\n\n  random_project_id           = true\n  random_project_id_length    = 4\n  name                        = format("%s-%s-shared-base", local.project_prefix, var.environment_code)\n  org_id                      = local.org_id\n  billing_account             = local.billing_account\n  folder_id                   = google_folder.env.id\n  disable_services_on_destroy = false\n  depends_on                  = [time_sleep.wait_60_seconds]\n  activate_apis = [\n    "compute.googleapis.com",\n    "dns.googleapis.com",\n    "servicenetworking.googleapis.com",\n    "container.googleapis.com",\n    "logging.googleapis.com",\n    "billingbudgets.googleapis.com"\n  ]\n\n  labels = {\n    environment       = var.env\n    application_name  = "base-shared-vpc-host"\n    billing_code      = "1234"\n    primary_contact   = "example1"\n    secondary_contact = "example2"\n    business_code     = "abcd"\n    env_code          = var.environment_code\n  }\n  budget_alert_pubsub_topic   = var.project_budget.base_network_alert_pubsub_topic\n  budget_alert_spent_percents = var.project_budget.base_network_alert_spent_percents\n  budget_amount               = var.project_budget.base_network_budget_amount\n}\n\nmodule "restricted_shared_vpc_host_project" {\n  source  = "terraform-google-modules/project-factory/google"\n  version = "~> 14.0"\n\n  random_project_id           = true\n  random_project_id_length    = 4\n  name                        = format("%s-%s-shared-restricted", local.project_prefix, var.environment_code)\n  org_id                      = local.org_id\n  billing_account             = local.billing_account\n  folder_id                   = google_folder.env.id\n  disable_services_on_destroy = false\n  depends_on                  = [time_sleep.wait_60_seconds]\n  activate_apis = [\n    "compute.googleapis.com",\n    "dns.googleapis.com",\n    "servicenetworking.googleapis.com",\n    "container.googleapis.com",\n    "logging.googleapis.com",\n    "cloudresourcemanager.googleapis.com",\n    "accesscontextmanager.googleapis.com",\n    "billingbudgets.googleapis.com"\n  ]\n\n  labels = {\n    environment       = var.env\n    application_name  = "restricted-shared-vpc-host"\n    billing_code      = "1234"\n    primary_contact   = "example1"\n    secondary_contact = "example2"\n    business_code     = "abcd"\n    env_code          = var.environment_code\n  }\n  budget_alert_pubsub_topic   = var.project_budget.restricted_network_alert_pubsub_topic\n  budget_alert_spent_percents = var.project_budget.restricted_network_alert_spent_percents\n  budget_amount               = var.project_budget.restricted_network_budget_amount\n}\n\n'), ('outputs.tf', '/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\noutput "env_folder" {\n  description = "Environment folder created under parent."\n  value       = google_folder.env.name\n}\n\noutput "monitoring_project_id" {\n  description = "Project for monitoring infra."\n  value       = module.monitoring_project.project_id\n}\n\noutput "base_shared_vpc_project_id" {\n  description = "Project for base shared VPC network."\n  value       = module.base_shared_vpc_host_project.project_id\n}\n\noutput "restricted_shared_vpc_project_id" {\n  description = "Project for restricted shared VPC network."\n  value       = module.restricted_shared_vpc_host_project.project_id\n}\n\noutput "restricted_shared_vpc_project_number" {\n  description = "Project number for restricted shared VPC."\n  value       = module.restricted_shared_vpc_host_project.project_number\n}\n\noutput "env_secrets_project_id" {\n  description = "Project for environment secrets."\n  value       = module.env_secrets.project_id\n}\n\noutput "assured_workload_id" {\n  description = "Assured Workload ID."\n  value       = var.assured_workload_configuration.enabled ? google_assured_workloads_workload.workload[0].id : ""\n}\n\noutput "assured_workload_resources" {\n  description = "Resources associated with the Assured Workload."\n  value       = var.assured_workload_configuration.enabled ? google_assured_workloads_workload.workload[0].resources : []\n}\n\n'), ('secrets.tf', '\n/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/******************************************\n  Project for Environment Secrets\n*****************************************/\n\nmodule "env_secrets" {\n  source  = "terraform-google-modules/project-factory/google"\n  version = "~> 14.0"\n\n  random_project_id           = true\n  random_project_id_length    = 4\n  default_service_account     = "deprivilege"\n  name                        = "${local.project_prefix}-${var.environment_code}-secrets"\n  org_id                      = local.org_id\n  billing_account             = local.billing_account\n  folder_id                   = google_folder.env.id\n  disable_services_on_destroy = false\n  depends_on                  = [time_sleep.wait_60_seconds]\n  activate_apis               = ["logging.googleapis.com", "secretmanager.googleapis.com"]\n\n  labels = {\n    environment       = var.env\n    application_name  = "env-secrets"\n    billing_code      = "1234"\n    primary_contact   = "example1"\n    secondary_contact = "example2"\n    business_code     = "abcd"\n    env_code          = var.environment_code\n  }\n  budget_alert_pubsub_topic   = var.project_budget.secret_alert_pubsub_topic\n  budget_alert_spent_percents = var.project_budget.secret_alert_spent_percents\n  budget_amount               = var.project_budget.secret_budget_amount\n}\n\n'), ('variables.tf', '/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvariable "env" {\n  description = "The environment to prepare (ex. development)"\n  type        = string\n}\n\nvariable "environment_code" {\n  type        = string\n  description = "A short form of the folder level resources (environment) within the Google Cloud organization (ex. d)."\n}\n\nvariable "remote_state_bucket" {\n  description = "Backend bucket to load Terraform Remote State Data from previous steps."\n  type        = string\n}\n\nvariable "monitoring_workspace_users" {\n  description = "Google Workspace or Cloud Identity group that have access to Monitoring Workspaces."\n  type        = string\n}\n\nvariable "project_budget" {\n  description = <<EOT\n  Budget configuration for projects.\n  budget_amount: The amount to use as the budget.\n  alert_spent_percents: A list of percentages of the budget to alert on when threshold is exceeded.\n  alert_pubsub_topic: The name of the Cloud Pub/Sub topic where budget related messages will be published, in the form of `projects/{project_id}/topics/{topic_id}`.\n  EOT\n  type = object({\n    base_network_budget_amount              = optional(number, 1000)\n    base_network_alert_spent_percents       = optional(list(number), [0.5, 0.75, 0.9, 0.95])\n    base_network_alert_pubsub_topic         = optional(string, null)\n    restricted_network_budget_amount        = optional(number, 1000)\n    restricted_network_alert_spent_percents = optional(list(number), [0.5, 0.75, 0.9, 0.95])\n    restricted_network_alert_pubsub_topic   = optional(string, null)\n    monitoring_budget_amount                = optional(number, 1000)\n    monitoring_alert_spent_percents         = optional(list(number), [0.5, 0.75, 0.9, 0.95])\n    monitoring_alert_pubsub_topic           = optional(string, null)\n    secret_budget_amount                    = optional(number, 1000)\n    secret_alert_spent_percents             = optional(list(number), [0.5, 0.75, 0.9, 0.95])\n    secret_alert_pubsub_topic               = optional(string, null)\n  })\n  default = {}\n}\n\nvariable "assured_workload_configuration" {\n  description = <<EOT\n  Assured Workload configuration. See https://cloud.google.com/assured-workloads ."\n  enabled: If the assured workload should be created.\n  location: The location where the workload will be created.\n  display_name: User-assigned resource display name.\n  compliance_regime: Supported Compliance Regimes. See https://cloud.google.com/assured-workloads/docs/reference/rest/Shared.Types/ComplianceRegime .\n  resource_type: The type of resource. One of CONSUMER_FOLDER, KEYRING, or ENCRYPTION_KEYS_PROJECT.\n  EOT\n  type = object({\n    enabled           = optional(bool, false)\n    location          = optional(string, "us-central1")\n    display_name      = optional(string, "FEDRAMP-MODERATE")\n    compliance_regime = optional(string, "FEDRAMP_MODERATE")\n    resource_type     = optional(string, "CONSUMER_FOLDER")\n  })\n  default = {}\n}\n\n'), ('versions.tf', '/**\n * Copyright 2021-2023 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nterraform {\n  required_version = ">= 1.3"\n  required_providers {\n    google = {\n      source  = "hashicorp/google"\n      version = ">= 3.50"\n    }\n    google-beta = {\n      source  = "hashicorp/google-beta"\n      version = ">= 3.50"\n    }\n  }\n\n  provider_meta "google" {\n    module_name = "blueprints/terraform/terraform-example-foundation:environments/v3.0.0"\n  }\n\n  provider_meta "google-beta" {\n    module_name = "blueprints/terraform/terraform-example-foundation:environments/v3.0.0"\n  }\n}\n\n')]